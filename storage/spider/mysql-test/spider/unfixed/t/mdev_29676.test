--echo #
--echo # MDEV-29676 Dual thread hang in 'closing tables' and 'Waiting for table metadata lock' on Spider CREATE OR REPLACE TABLE
--echo #

--disable_query_log
--disable_result_log
--source ../../t/test_init.inc
--enable_result_log
--enable_query_log

eval CREATE SERVER srv FOREIGN DATA WRAPPER MYSQL OPTIONS (SOCKET "$MASTER_1_MYSOCK", DATABASE 'test',user 'root');
CREATE TABLE t (c INT) ENGINE=Spider COMMENT='WRAPPER "mysql", srv "srv",TABLE "t"';

SET @old_lock_wait_timeout=@@global.lock_wait_timeout;
SET GLOBAL lock_wait_timeout=1;

--echo # UNFIXED: the bug is indicated by some timeout warnings here, and requires a commit like e34024e00ac
CREATE OR REPLACE TABLE t (c INT);
SET GLOBAL lock_wait_timeout=@old_lock_wait_timeout;

DROP TABLE t;

--disable_query_log
--disable_result_log
--source ../../t/test_deinit.inc
--enable_result_log
--enable_query_log
